# Система Рекомендаций Лотерей СтоЛото

## Обзор проекта

Веб-система персонализированных рекомендаций лотерей СтоЛото с интерактивным обучением и чат-ботом для сбора параметров пользователя. Система полностью на русском языке, стилизована под фирменный дизайн СтоЛото.

## Основные функции

- **Персонализированные рекомендации** - Подбор лотерей на основе предпочтений пользователя с персонализированными описаниями причин выбора
- **Интерактивный чат-бот** - Красивый интерфейс для сбора параметров (цена билета, частота игры, тип лотереи, джекпот, вероятность)
- **Система обучения** - Интерактивное обучение для новых пользователей с блюром фона, анимациями и навигацией по стрелкам
- **Сохранение параметров** - LocalStorage и cookies для запоминания предпочтений и избранных наборов параметров
- **Отслеживание изменений** - Пометка новых рекомендаций при повторном просмотре сохраненных параметров
- **Каталог лотерей** - Просмотр всех доступных лотерей с детальной информацией

## Технический стек

### Frontend
- **React 18** - UI библиотека
- **TypeScript** - Типизация
- **Tailwind CSS** - Стилизация
- **Shadcn UI** - Компоненты
- **Framer Motion** - Анимации
- **Wouter** - Маршрутизация
- **TanStack Query** - Управление данными
- **date-fns** - Форматирование дат
- **js-cookie** - Работа с cookies

### Backend
- **Express.js** - HTTP сервер
- **TypeScript** - Типизация
- **In-memory storage** - Хранилище данных
- **Zod** - Валидация схем

### Интеграция
- **Stoloto API** - Получение данных о лотереях (https://github.com/D0UP1G/StolotoAPI)

## Архитектура проекта

### Frontend структура (модульная)

```
client/src/
├── components/          # Переиспользуемые UI компоненты
│   ├── Header.tsx
│   ├── Tutorial.tsx     # Интерактивное обучение
│   ├── Chatbot.tsx      # Чат-бот для сбора параметров
│   ├── LotteryCard.tsx
│   ├── RecommendationCard.tsx
│   └── ui/              # Shadcn компоненты
├── pages/               # Страницы приложения
│   ├── Home.tsx
│   ├── Recommendations.tsx
│   ├── SavedParameters.tsx
│   └── LotteryDetail.tsx
├── services/            # Сервисы
│   └── storage.service.ts
├── hooks/               # Кастомные хуки
│   ├── useLocalStorage.ts
│   └── useTutorial.ts
├── lib/                 # Утилиты
│   ├── queryClient.ts
│   └── utils.ts
└── App.tsx
```

### Backend структура (модульная)

```
server/
├── routes.ts            # API маршруты
├── services/            # Бизнес-логика
│   ├── stoloto.service.ts        # Работа с Stoloto API
│   └── recommendation.service.ts # Алгоритм рекомендаций
├── utils/               # Утилиты и алгоритмы
└── storage.ts           # In-memory хранилище
```

### Shared структура

```
shared/
└── schema.ts            # Общие типы и схемы Zod
```

## Схемы данных

### Lottery (Лотерея)
- id, name, type, ticketPrice
- maxJackpot, currentJackpot, winProbability
- drawFrequency, description, rules
- prizeStructure[] - структура призов

### UserPreferences (Параметры пользователя)
- ticketPrice: { min, max }
- playFrequency: частота игры
- lotteryType: тип лотереи (опционально)
- maxJackpot: { min, max }
- winProbability: { min, max }

### Recommendation (Рекомендация)
- lottery: объект лотереи
- matchScore: оценка совпадения 0-100
- personalizedReason: персонализированное описание
- matchedCriteria[]: совпавшие критерии
- isNew: флаг новой рекомендации

### SavedParameters (Сохраненные параметры)
- id, name, preferences
- savedAt: дата сохранения
- lotteryIds[]: ID рекомендованных лотерей

## Дизайн-система СтоЛото

### Цвета
- **Primary (желтый)**: hsl(38.23, 87.6%, 74.71%)
- **Secondary (темно-коричневый)**: hsl(39.27, 43.31%, 24.9%)
- **Destructive (красный)**: hsl(0.49, 54.19%, 55.49%)
- **Background (светло-желтый)**: hsl(45, 100%, 96.86%)
- **Foreground (темно-коричневый)**: hsl(38.18, 53.23%, 24.31%)

### Шрифты
- **Serif (Lora)**: Заголовки, цифры, акценты
- **Sans-serif (Space Grotesk)**: Основной текст, UI

### Радиус скругления
- **lg**: 0.875rem (14px) - фирменный радиус СтоЛото
- **md**: 0.625rem (10px)
- **sm**: 0.375rem (6px)

## API Endpoints

### GET /api/lotteries
Получить список всех доступных лотерей

### GET /api/lotteries/:id
Получить детальную информацию о лотерее

### POST /api/recommendations
Получить персонализированные рекомендации
```json
{
  "preferences": { ... },
  "previousLotteryIds": [] // опционально, для отслеживания изменений
}
```

## LocalStorage/Cookies

### LocalStorage
- `stoloto_current_preferences` - текущие предпочтения пользователя
- `stoloto_saved_parameters` - массив сохраненных наборов параметров
- `stoloto_tutorial_completed` - статус прохождения обучения
- `stoloto_last_visit` - дата последнего визита

### Cookies
- `stoloto_user_id` - уникальный ID пользователя (срок хранения: 1 год)

## Особенности реализации

### Интерактивное обучение
- Автоматический запуск для новых пользователей
- Блюр всего фона кроме изучаемого элемента
- Плавные анимации переходов между шагами (400ms)
- Навигация по стрелкам
- Кнопка закрытия в любой момент
- Возможность повторного запуска

### Чат-бот
- Пошаговый сбор параметров (5 шагов)
- Красивые диалоговые окна
- Анимация сообщений (slide-in слева/справа)
- Кнопки быстрого выбора опций
- Индикатор прогресса

### Персонализированные рекомендации
- Алгоритм расчета совпадения (matchScore)
- Генерация уникальных описаний для каждой лотереи
- Список совпавших критериев
- Пометка "Новая!" для новых рекомендаций

### Сохранение и отслеживание
- Сохранение нескольких наборов параметров
- Сравнение текущих рекомендаций с предыдущими
- Пометка новых лотерей при обновлении

## Запуск проекта

Проект запускается через workflow "Start application", который выполняет:
```bash
npm run dev
```

Это запускает Express сервер для backend и Vite сервер для frontend на одном порту (обычно 5000).

## Последние изменения

- **23.11.2025 20:30**: ✅ Проект полностью реализован и протестирован
- ✅ Frontend: Все компоненты (Header, Tutorial, Chatbot, LotteryCard, RecommendationCard)
- ✅ Страницы: Home, Recommendations, SavedParameters, LotteryDetail  
- ✅ Backend: StolotoService, RecommendationService, API routes (/api/lotteries, /api/recommendations)
- ✅ Дизайн-система СтоЛото с фирменными цветами (желтый, коричневый, красный) и шрифтами (Lora, Space Grotesk)
- ✅ Сервисы: StorageService для localStorage/cookies, useTutorial, useLocalStorage
- ✅ Алгоритм персонализированных рекомендаций с оценкой совпадения и русскими описаниями
- ✅ Система пометки новых рекомендаций (isNew flag)
- ✅ Модульная архитектура frontend и backend
- ✅ Все API endpoints протестированы и работают (200 OK)

**Статус:** Готово к использованию
